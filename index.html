<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Control de EPP – Pozuelo</title>
    
    <!-- Scripts para React y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Gemini API SDK -->
    <script src="https://sdk.vercel.ai/google/genai-dev.js"></script>

    <!-- Script de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #ffffff;
      }
    </style>
</head>
<body>
    <div id="root"></div>
    <!-- 
      Todo el código de la aplicación React está ahora dentro de esta única etiqueta.
      Babel lo transpilará al vuelo. Esto evita errores de CORS al abrir el archivo localmente.
    -->
    <script type="text/babel">
// ====================================================================================
// In-lined 'types.ts'
// ====================================================================================
var Screen;
(function (Screen) {
    Screen["HOME"] = "HOME";
    Screen["REQUEST"] = "SOLICITUD DE EPP";
    Screen["DELIVERY"] = "ENTREGA DE EPP";
    Screen["CONSULTA_DE_DOTACION"] = "CONSULTA DE DOTACION";
    Screen["INVENTORY"] = "CONTROL DE INVENTARIO";
})(Screen || (Screen = {}));

// ====================================================================================
// In-lined 'constants.ts'
// ====================================================================================
const PASSWORDS = {
    [Screen.HOME]: '',
    [Screen.REQUEST]: '',
    [Screen.DELIVERY]: '',
    [Screen.CONSULTA_DE_DOTACION]: '',
    [Screen.INVENTORY]: ''
};


// ====================================================================================
// In-lined 'services/googleSheetsService.ts'
// ====================================================================================
const GoogleSheets = (() => {
    const IS_LOCAL = typeof google === 'undefined' || typeof google.script === 'undefined';

    const MOCK_EPP_COLUMNS = [
        "Casco de Seguridad Blanco", "Lentes de Seguridad Claros", "Guantes de Nitrilo",
        "Protector Auditivo de Copa", "Zapatos de Seguridad", "Mascarilla Desechable"
    ];

    const MOCK_INVENTORY = [
      { id: 'CAS-001', description: 'Casco de Seguridad Blanco', quantity: 50 },
      { id: 'LEN-002', description: 'Lentes de Seguridad Claros', quantity: 120 },
      { id: 'GUA-003', description: 'Guantes de Nitrilo', quantity: 300 },
      { id: 'PRO-004', description: 'Protector Auditivo de Copa', quantity: 75 },
      { id: 'ZAP-005', description: 'Zapatos de Seguridad', quantity: 40 },
      { id: 'MAS-006', description: 'Mascarilla Desechable', quantity: 1000 },
    ];

    const MOCK_APPROVERS = [
      { id: '5658', name: 'William Alfaro Delgado' },
      { id: '9876', name: 'Ana Solís' },
    ];

    const MOCK_DELIVERIES = {
      '5658': {
          employeeName: 'William Alfaro Delgado',
          items: {
              "Casco de Seguridad Blanco": "20/07/2024",
              "Zapatos de Seguridad": "15/06/2024",
          }
      },
      '1234': {
          employeeName: 'Carlos Ramirez',
          items: {
              "Lentes de Seguridad Claros": "18/07/2024",
              "Guantes de Nitrilo": "18/07/2024",
          }
      }
    };

    if (IS_LOCAL) {
        console.log(
          '%cMODO DE DESARROLLO LOCAL ACTIVADO',
          'color: #f97216; font-size: 14px; font-weight: bold; background-color: #fff7ed; padding: 4px 8px; border-radius: 4px; border: 1px solid #fed7aa;'
        );
    }

    const getInitialData = () => {
        if (IS_LOCAL) {
            return new Promise(resolve => setTimeout(() => resolve({
                inventory: MOCK_INVENTORY,
                authorizedApprovers: MOCK_APPROVERS,
                eppColumns: MOCK_EPP_COLUMNS,
            }), 500));
        }
        return new Promise((resolve, reject) => {
            google.script.run
                .withSuccessHandler(resolve)
                .withFailureHandler(reject)
                .getInitialData();
        });
    };

    const processDelivery = (request, approver) => {
        if (IS_LOCAL) {
             console.log("Procesando entrega localmente:", { request, approver });
            request.items.forEach(reqItem => {
                const itemInStock = MOCK_INVENTORY.find(invItem => invItem.id === reqItem.itemId);
                if (itemInStock && itemInStock.quantity > 0) {
                    itemInStock.quantity -= 1;
                }
            });
            return new Promise(resolve => setTimeout(() => resolve({ success: true }), 500));
        }
        return new Promise((resolve, reject) => {
            google.script.run
                .withSuccessHandler(resolve)
                .withFailureHandler(reject)
                .processDelivery(request, approver);
        });
    };

    const getEmployeeDotation = (employeeId) => {
        if (IS_LOCAL) {
            const dotation = MOCK_DELIVERIES[employeeId];
            if (dotation) {
                return new Promise(resolve => setTimeout(() => resolve({
                    found: true,
                    data: { employeeId: employeeId, employeeName: dotation.employeeName, items: dotation.items }
                }), 500));
            } else {
                 return new Promise(resolve => setTimeout(() => resolve({
                    found: false,
                    message: `MODO LOCAL: No se encontraron entregas para el código: ${employeeId}`
                 }), 500));
            }
        }
         return new Promise((resolve, reject) => {
            google.script.run
                .withSuccessHandler(resolve)
                .withFailureHandler(reject)
                .getEmployeeDotation(employeeId);
        });
    };

    return { getInitialData, processDelivery, getEmployeeDotation };
})();


// ====================================================================================
// In-lined 'services/geminiService.ts'
// ====================================================================================
const GeminiService = (() => {
  if (typeof GoogleGenAI === 'undefined') {
      console.warn("GoogleGenAI SDK no encontrado. Las funciones de Gemini estarán deshabilitadas.");
      return {
          getInventoryInsights: async () => "Error: El SDK del Asistente IA (GoogleGenAI) no se ha cargado."
      };
  }
  
  const IS_API_KEY_AVAILABLE = typeof process !== 'undefined' && process.env && process.env.API_KEY;

  if (!IS_API_KEY_AVAILABLE) {
      console.log(
          '%cMODO LOCAL: API_KEY no encontrada. El Asistente IA usará respuestas simuladas.',
          'color: #16a34a; font-size: 14px; font-weight: bold; background-color: #f0fdf4; padding: 4px 8px; border-radius: 4px; border: 1px solid #bbf7d0;'
      );
      
      const getInventoryInsights = async (inventory, query) => {
        await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay
        const lowerQuery = query.toLowerCase();
        
        const lessThanMatch = lowerQuery.match(/menos de (\d+)/);
        if (lessThanMatch || lowerQuery.includes("low stock")) {
            const threshold = lessThanMatch ? parseInt(lessThanMatch[1], 10) : 50;
            const lowStockItems = inventory
                .filter(item => item.quantity < threshold)
                .map(item => `${item.description} (${item.quantity})`);
            
            if (lowStockItems.length > 0) {
              return `¡Hola! Soy CYBER-CLERK. Los artículos con menos de ${threshold} unidades son: ${lowStockItems.join(', ')}.`;
            } else {
              return `¡Hola! Soy CYBER-CLERK. Actualmente no hay artículos con menos de ${threshold} unidades en stock.`;
            }
        }
        if (lowerQuery.includes("más cantidad") || lowerQuery.includes("highest stock")) {
            if (!inventory || inventory.length === 0) {
              return "¡Hola! Soy CYBER-CLERK. El inventario está vacío, no puedo determinar el artículo con más stock.";
            }
            const highestStockItem = inventory.reduce((max, item) => item.quantity > max.quantity ? item : max, inventory[0]);
            return `¡Hola! Soy CYBER-CLERK. El artículo con la mayor cantidad en stock es: ${highestStockItem.description} (${highestStockItem.quantity}).`;
        }
        return `¡Hola! Soy CYBER-CLERK, tu asistente de inventario. He recibido tu consulta: "${query}".\n\nEn el modo local, mis respuestas son limitadas. Para un análisis completo, la aplicación debe ejecutarse en un entorno con la API_KEY de Google configurada.`;
      };
      return { getInventoryInsights };
  }

  // REAL IMPLEMENTATION
  const ai = new GoogleGenAI({apiKey: process.env.API_KEY});

  const getInventoryInsights = async (inventory, query) => {
    const systemInstruction = "Eres un asistente experto en análisis de inventario para una empresa llamada Pozuelo. Tu nombre es CYBER-CLERK. Se te proporcionará el estado actual del inventario en formato JSON y una pregunta del usuario. Analiza los datos para responder a la pregunta de forma concisa y útil. Responde siempre en español. Sé amigable y profesional.";
    const contents = `Analiza los siguientes datos de inventario y responde a la pregunta del usuario.\n\nInventario (JSON):\n${JSON.stringify(inventory, null, 2)}\n\nPregunta: "${query}"`;
    
    try {
      const response = await ai.models.generateContent({
        model: 'gemini-2.5-flash',
        contents: contents,
        config: {
          systemInstruction: systemInstruction,
        }
      });
      return response.text;
    } catch (error) {
      console.error("Error al llamar a la API de Gemini:", error);
      return `Se produjo un error al contactar al asistente de IA. Por favor, inténtelo de nuevo más tarde.\n\nDetalles del error: ${error.message}`;
    }
  };

  return { getInventoryInsights };
})();

// ====================================================================================
// In-lined 'components/icons/*.tsx'
// ====================================================================================
const RequestIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" className="h-10 w-10 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2} {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
  </svg>
);
const DeliveryIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M21.75 9.75v4.5a3 3 0 01-3 3h-1.5a3 3 0 01-3-3v-4.5" />
    <path strokeLinecap="round" strokeLinejoin="round" d="M14.25 9.75v-3a3 3 0 00-3-3H9a3 3 0 00-3 3v10.5" />
    <path strokeLinecap="round" strokeLinejoin="round" d="M9 3.75H7.5a3 3 0 00-3 3v10.5a3 3 0 003 3h1.5" />
  </svg>
);
const InventoryIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" className="h-10 w-10 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2} {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4M4 7s0 0 .001 0M20 7s0 0-.001 0M12 11c-3.333 0-6-1.343-6-3s2.667-3 6-3 6 1.343 6 3-2.667 3-6 3z" />
  </svg>
);
const ConsultationIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0L21 21" />
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 12a3 3 0 100-6 3 3 0 000 6z" />
  </svg>
);
const CatalogIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
  </svg>
);

// ====================================================================================
// In-lined 'components/GeometricPattern.tsx'
// ====================================================================================
const GeometricPattern = ({ position }) => {
  const positionClasses = {
    'top-left': 'top-0 left-0',
    'bottom-right': 'bottom-0 right-0 transform rotate-180',
  };
  return (
    <div className={`absolute ${positionClasses[position]} w-[40vw] max-w-md h-auto z-0 pointer-events-none`}>
      <svg width="100%" height="100%" viewBox="0 0 453 336" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <path d="M-58.5 224L156.5 0H339.5L124.5 224H-58.5Z" fill="#F472B6" /><path d="M157 0L339.5 224H124.5L-58 0H157Z" fill="#A78BFA" /><path d="M109 336L324 112L282.5 31.5L-11.5 255.5L109 336Z" fill="#F97316" /><path d="M282.5 31.5L324 112L453 112L390 -9.00001L282.5 31.5Z" fill="#34D399" /><path d="M339 224.5L453 112L390 -9L282 31.5L339 224.5Z" fill="#60A5FA" /><path d="M339.5 224L282.5 31.5L324 112L339.5 224Z" fill="#EC4899" /><path d="M339.5 224L124.5 224L109 336L339.5 224Z" fill="#C084FC" /><path d="M156.5 0H339.5L124.5 224L-58.5 224L156.5 0Z" fill="url(#paint0_linear_1_2)" fillOpacity="0.3"/><defs><linearGradient id="paint0_linear_1_2" x1="140.5" y1="112" x2="313" y2="112" gradientUnits="userSpaceOnUse"><stop stopColor="white" stopOpacity="0"/><stop offset="1" stopColor="white"/></linearGradient></defs>
      </svg>
    </div>
  );
};

// ====================================================================================
// In-lined 'components/NeonButton.tsx'
// ====================================================================================
const NeonButton = ({ children, variant = 'primary', className, ...props }) => {
  const variantClasses = {
    primary: 'bg-white text-gray-800 hover:bg-slate-100 shadow-md border border-gray-200',
    secondary: 'bg-[#f97216] text-white hover:bg-[#dd6614] shadow-md shadow-[#f97216]/30 border border-[#dd6614]',
  };
  return (
    <button className={`px-6 py-3 font-bold text-sm uppercase tracking-wider rounded-lg transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-[#fdba74] ${variantClasses[variant]} ${className || ''}`} {...props}>
      {children}
    </button>
  );
};


// ====================================================================================
// In-lined 'components/Toast.tsx'
// ====================================================================================
const Toast = ({ message, onDismiss }) => {
  React.useEffect(() => {
    const timer = setTimeout(() => { onDismiss(message.id); }, 3000);
    return () => clearTimeout(timer);
  }, [message, onDismiss]);

  const baseClasses = 'fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white font-bold z-50 transform transition-all duration-300 flex items-center';
  const typeClasses = { success: 'bg-emerald-500', error: 'bg-red-500' };

  return (
    <div className={`${baseClasses} ${typeClasses[message.type]}`}>
      {message.type === 'success' && (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>)}
      {message.type === 'error' && (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>)}
      {message.message}
    </div>
  );
};


// ====================================================================================
// In-lined 'components/PasswordModal.tsx'
// ====================================================================================
const PasswordModal = ({ screen, onSuccess, onClose, validatePassword }) => {
  const { useState, useEffect, useRef } = React;
  const [password, setPassword] = useState('');
  const [error, setError] = useState(false);
  const inputRef = useRef(null);

  useEffect(() => { if (inputRef.current) inputRef.current.focus(); }, []);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (validatePassword(password)) {
      onSuccess(password);
    } else {
      setError(true);
      setPassword('');
      setTimeout(() => setError(false), 1000);
    }
  };
  return (
    <div className="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex justify-center items-center z-50 p-4">
      <div className={`p-8 bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all ${error ? 'animate-shake' : ''}`}>
        <h2 className="text-3xl font-extrabold text-gray-800 text-center mb-2">Acceso Restringido</h2>
        <p className="text-center text-gray-500 mb-6">Introduzca la clave para: <span className="font-bold text-gray-700">{screen}</span></p>
        <form onSubmit={handleSubmit}>
          <input ref={inputRef} type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full px-4 py-3 bg-slate-100 border-2 border-slate-200 rounded-lg text-center text-2xl text-gray-700 tracking-widest focus:border-[#f97216] focus:ring-[#f97216] focus:outline-none transition-colors" placeholder="****"/>
          {error && <p className="text-red-500 text-center mt-2 font-semibold">Clave Incorrecta</p>}
          <div className="flex justify-around mt-8">
            <NeonButton type="button" variant="primary" onClick={onClose} className="w-2/5">Cancelar</NeonButton>
            <NeonButton type="submit" variant="secondary" className="w-2/5">Entrar</NeonButton>
          </div>
        </form>
      </div>
      <style>{`@keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } } .animate-shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }`}</style>
    </div>
  );
};


// ====================================================================================
// In-lined 'context/InventoryContext.tsx'
// ====================================================================================
const InventoryContext = React.createContext(undefined);

const InventoryProvider = ({ children }) => {
  const { useState, useCallback, useEffect } = React;
  const [state, setState] = useState({
    inventory: [], requests: [], authorizedApprovers: [], eppColumns: [],
    currentApprover: null, isLoading: true, error: null,
  });

  const fetchData = useCallback(async () => {
    setState(s => ({ ...s, isLoading: true, error: null }));
    try {
      const data = await GoogleSheets.getInitialData();
      if (data.error) throw new Error(data.error);
      setState(s => ({ ...s, inventory: data.inventory, authorizedApprovers: data.authorizedApprovers, eppColumns: data.eppColumns, isLoading: false }));
    } catch (err) {
      console.error("Failed to fetch initial data:", err);
      setState(s => ({ ...s, isLoading: false, error: err.message || 'Error al cargar los datos.' }));
    }
  }, []);

  useEffect(() => { fetchData(); }, [fetchData]);

  const findItemById = useCallback((id) => state.inventory.find(item => item.id.toLowerCase() === id.toLowerCase()), [state.inventory]);
  const findApproverById = useCallback((id) => state.authorizedApprovers.find(app => app.id.toString() === id), [state.authorizedApprovers]);

  const addRequest = (payload) => {
    const newRequest = { id: `REQ-${Date.now()}`, ...payload };
    setState(s => ({ ...s, requests: [...s.requests, newRequest] }));
  };

  const approveAndProcessDelivery = async (requestToApprove) => {
    if (!state.currentApprover) return { success: false, error: "No hay un aprobador activo." };
    const result = await GoogleSheets.processDelivery(requestToApprove, state.currentApprover);
    if (result.success) {
      setState(s => ({ ...s, requests: s.requests.filter(req => req.id !== requestToApprove.id) }));
      const data = await GoogleSheets.getInitialData();
      if (!data.error) setState(s => ({ ...s, inventory: data.inventory }));
    }
    return result;
  };

  const loginApprover = (approver) => setState(s => ({ ...s, currentApprover: approver }));
  const logoutApprover = () => setState(s => ({ ...s, currentApprover: null }));

  const value = { state, addRequest, approveAndProcessDelivery, loginApprover, logoutApprover, findItemById, findApproverById, reloadData: fetchData };

  return <InventoryContext.Provider value={value}>{children}</InventoryContext.Provider>;
};

const useInventory = () => {
  const context = React.useContext(InventoryContext);
  if (context === undefined) throw new Error('useInventory must be used within an InventoryProvider');
  return context;
};

// ====================================================================================
// In-lined 'components/Header.tsx'
// ====================================================================================
const Header = () => (
    <header className="relative z-20 pt-16 pb-12 px-4 sm:px-6 lg:px-8">
        <a href="https://google.com" target="_blank" rel="noopener noreferrer" aria-label="Catálogo de EPP" title="Catálogo de EPP" className="absolute top-0 right-5 mt-6 flex flex-col items-center gap-2 px-4 py-3 bg-white rounded-2xl shadow-lg hover:shadow-2xl hover:bg-slate-100 transition-all duration-300 transform hover:-translate-y-1">
          <CatalogIcon className="w-8 h-8 text-[#f97216]" />
          <span className="font-semibold text-xs text-gray-700">Catálogo de EPP</span>
        </a>
        <div className="max-w-screen-xl mx-auto text-center">
            <h1 className="text-4xl md:text-5xl lg:text-6xl font-extrabold text-gray-900 tracking-wider uppercase">CONTROL DE EPP</h1>
            <p className="text-lg md:text-xl text-gray-600 mt-2">Departamento de SST</p>
        </div>
    </header>
);

// ====================================================================================
// In-lined 'components/Layout.tsx'
// ====================================================================================
const Layout = ({ children }) => (
    <div className="relative min-h-screen bg-white overflow-hidden">
      <GeometricPattern position="top-left" />
      <Header />
      <main className="relative z-10">{children}</main>
      <GeometricPattern position="bottom-right" />
      <footer className="text-center text-xs text-gray-500 py-4 relative z-10 bg-white">
        Compañía de Galletas Pozuelo - Desarrollado por pzwadelgado
      </footer>
    </div>
);


// ====================================================================================
// In-lined 'components/RequestScreen.tsx'
// ====================================================================================
const RequestScreen = ({ onBack, showToast }) => {
  const { useState } = React;
  const { addRequest, findItemById } = useInventory();
  const [requesterName, setRequesterName] = useState('');
  const [requesterId, setRequesterId] = useState('');
  const [reason, setReason] = useState('Nueva Entrega');
  const [collaborators, setCollaborators] = useState([]);
  const [newEmployeeId, setNewEmployeeId] = useState('');
  const [newEmployeeName, setNewEmployeeName] = useState('');

  const handleAddCollaborator = () => {
    if (!newEmployeeId || !newEmployeeName) return showToast('Debe ingresar el código y el nombre del colaborador.', 'error');
    if (collaborators.some(c => c.employeeId === newEmployeeId)) return showToast('Este colaborador ya ha sido añadido a la solicitud.', 'error');
    const newCollaborator = { id: Date.now(), employeeId: newEmployeeId, employeeName: newEmployeeName, items: [], currentItemCode: '' };
    setCollaborators(prev => [...prev, newCollaborator]);
    setNewEmployeeId('');
    setNewEmployeeName('');
  };

  const removeCollaborator = (collaboratorId) => setCollaborators(prev => prev.filter(c => c.id !== collaboratorId));
  const handleItemCodeChange = (collaboratorId, code) => setCollaborators(prev => prev.map(c => c.id === collaboratorId ? { ...c, currentItemCode: code } : c));
  
  const handleAddItem = (collaboratorId) => {
    const collaborator = collaborators.find(c => c.id === collaboratorId);
    if (!collaborator || !collaborator.currentItemCode) return showToast('Por favor, introduzca un código de artículo.', 'error');
    const item = findItemById(collaborator.currentItemCode);
    if (!item) return showToast('Código de artículo no encontrado.', 'error');
    const newItem = { id: Date.now(), itemId: item.id, itemDescription: item.description };
    setCollaborators(prev => prev.map(c => c.id === collaboratorId ? { ...c, items: [...c.items, newItem], currentItemCode: '' } : c));
  };

  const handleItemCodeKeyPress = (event, collaboratorId) => { if (event.key === 'Enter') { event.preventDefault(); handleAddItem(collaboratorId); }};
  const removeItemFromCollaborator = (collaboratorId, itemId) => setCollaborators(prev => prev.map(c => c.id === collaboratorId ? { ...c, items: c.items.filter(item => item.id !== itemId) } : c));

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!requesterName || !requesterId) return showToast('Por favor, complete los datos del solicitante.', 'error');
    if (collaborators.length === 0) return showToast('Debe añadir al menos un colaborador.', 'error');
    if (collaborators.some(c => c.items.length === 0)) return showToast('Cada colaborador debe tener al menos un artículo.', 'error');
    const requestItems = [];
    collaborators.forEach(collab => { collab.items.forEach(item => { requestItems.push({ itemId: item.itemId, quantity: 1, employees: [{ employeeId: collab.employeeId, employeeName: collab.employeeName }] }); }); });
    addRequest({ requesterName, requesterId, items: requestItems, reason });
    showToast('Solicitud enviada y pendiente de aprobación.', 'success');
    setRequesterName(''); setRequesterId(''); setCollaborators([]);
  };

  const inputClass = "w-full bg-slate-100 border-2 border-slate-200 rounded-lg px-3 py-2 text-gray-700 focus:border-[#f97216] focus:ring-[#f97216] focus:outline-none transition-colors";

  return (
    <div className="w-full max-w-5xl mx-auto p-8 bg-white rounded-2xl shadow-xl">
      <h2 className="text-3xl font-extrabold text-gray-800 mb-8">{Screen.REQUEST}</h2>
      <form onSubmit={handleSubmit} className="space-y-8">
        <fieldset className="p-6 border border-slate-200 rounded-xl">
          <legend className="px-2 text-xl font-bold text-gray-700">Datos del Solicitante</legend>
          <div className="grid grid-cols-1 md:grid-cols-[3fr,1fr] gap-6">
            <div><label className="block text-gray-600 mb-2 font-semibold">Nombre del Solicitante</label><input type="text" value={requesterName} onChange={e => setRequesterName(e.target.value)} className={inputClass} placeholder="Nombre de Jefatura" required /></div>
            <div><label className="block text-gray-600 mb-2 font-semibold">Código</label><input type="text" value={requesterId} onChange={e => setRequesterId(e.target.value)} className={inputClass} placeholder="Ej: 5658" required /></div>
            <div className="md:col-span-2"><label className="block text-gray-600 mb-2 font-semibold">Motivo de la Solicitud</label><select value={reason} onChange={e => setReason(e.target.value)} className={inputClass} required><option>Nueva Entrega</option><option>Cambio por Daño</option></select></div>
          </div>
        </fieldset>
        <fieldset className="p-6 border border-slate-200 rounded-xl">
           <legend className="px-2 text-xl font-bold text-gray-700">Añadir Colaborador</legend>
           <div className="grid grid-cols-1 md:grid-cols-[1fr,4fr,auto] gap-4 items-end">
                <div><label className="block text-gray-600 mb-2 font-semibold">Código</label><input type="text" value={newEmployeeId} onChange={e => setNewEmployeeId(e.target.value)} className={inputClass} placeholder="Ej: 1234" /></div>
                 <div><label className="block text-gray-600 mb-2 font-semibold">Nombre del Colaborador</label><input type="text" value={newEmployeeName} onChange={e => setNewEmployeeName(e.target.value)} className={inputClass} placeholder="Mario Moreno Reyes" /></div>
                <NeonButton type="button" onClick={handleAddCollaborator} variant="secondary">Añadir</NeonButton>
           </div>
        </fieldset>
        {collaborators.length > 0 && (
          <fieldset className="p-6 border border-[#fed7aa] rounded-xl bg-[#fff7ed]">
            <legend className="px-2 text-xl font-bold text-[#9a3412]">Asignación de EPP</legend>
            <div className="space-y-6">
              {collaborators.map(collab => (
                  <div key={collab.id} className="p-4 bg-white border border-slate-200 rounded-lg shadow-md">
                    <div className="flex justify-between items-center mb-4">
                      <div><p className="font-bold text-lg text-gray-800">{collab.employeeName}</p><p className="text-sm text-gray-500 font-mono">{collab.employeeId}</p></div>
                      <button type="button" onClick={() => removeCollaborator(collab.id)} className="text-red-500 hover:text-red-700 transition-colors p-2 rounded-full hover:bg-red-100"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>
                    </div>
                    {collab.items.length > 0 && <ul className="space-y-2 mb-4">{collab.items.map(item => (<li key={item.id} className="flex justify-between items-center bg-slate-50 p-2 rounded-md border border-slate-200"><div><p className="font-semibold text-gray-800">{item.itemDescription}</p><p className="text-sm text-gray-500 font-mono">{item.itemId}</p></div><button type="button" onClick={() => removeItemFromCollaborator(collab.id, item.id)} className="text-gray-400 hover:text-red-600 transition-colors p-1 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg></button></li>))}</ul>}
                    <div className="grid grid-cols-1 md:grid-cols-[2fr,3fr,auto] gap-4 items-end pt-4 border-t border-slate-200">
                        <div><label className="block text-gray-600 mb-1 text-sm font-semibold">Código de Artículo</label><input type="text" value={collab.currentItemCode} onChange={e => handleItemCodeChange(collab.id, e.target.value)} onKeyPress={e => handleItemCodeKeyPress(e, collab.id)} className={inputClass} placeholder="Ej: CAS-001" /></div>
                        <div><label className="block text-gray-600 mb-1 text-sm font-semibold">Descripción</label><p className="text-gray-500 h-11 flex items-center px-3 bg-slate-50 rounded-lg border border-slate-200">{findItemById(collab.currentItemCode)?.description || '...'}</p></div>
                        <NeonButton type="button" variant="secondary" onClick={() => handleAddItem(collab.id)} className="h-11">Añadir Artículo</NeonButton>
                    </div>
                  </div>
              ))}
            </div>
          </fieldset>
        )}
        <div className="flex justify-between items-center pt-6 border-t border-slate-200">
          <NeonButton type="button" onClick={onBack} variant="primary">Volver</NeonButton>
          <NeonButton type="submit" variant="secondary" disabled={collaborators.length === 0 || collaborators.some(c => c.items.length === 0)}>Enviar Solicitud</NeonButton>
        </div>
      </form>
    </div>
  );
};

// ====================================================================================
// In-lined 'components/DeliveryScreen.tsx'
// ====================================================================================
const DeliveryScreen = ({ onBack, showToast }) => {
  const { useState } = React;
  const { state, logoutApprover, approveAndProcessDelivery, findItemById } = useInventory();
  const [processingId, setProcessingId] = useState(null);
  const { requests: pendingRequests, currentApprover } = state;

  const handleApprove = async (request) => {
    setProcessingId(request.id);
    const result = await approveAndProcessDelivery(request);
    showToast(result.success ? 'Solicitud aprobada y registrada.' : `Error: ${result.error}`, result.success ? 'success' : 'error');
    setProcessingId(null);
  };
  const handleGoBack = () => { logoutApprover(); onBack(); };

  return (
    <div className="w-full max-w-4xl mx-auto p-8 bg-white rounded-2xl shadow-xl">
      <h2 className="text-3xl font-extrabold text-gray-800 mb-4">{Screen.DELIVERY}</h2>
      {currentApprover && <div className="mb-8 p-4 bg-[#fff7ed] border border-[#fed7aa] rounded-lg text-center"><p className="text-lg text-[#7c2d12] font-bold">Aprobador: {currentApprover.name}</p><p className="text-sm text-[#f97216] font-mono">ID: {currentApprover.id}</p></div>}
      <div className="space-y-6">
        {pendingRequests.length > 0 ? pendingRequests.map(request => (
          <div key={request.id} className="p-5 bg-slate-50 border border-slate-200 rounded-xl">
            <div className="flex justify-between items-start flex-wrap gap-4">
                <div><h3 className="font-bold text-xl text-gray-800">Solicitud: <span className="font-mono text-[#f97216]">{request.id}</span></h3><p className="text-gray-600 mt-1"><span className="font-semibold">Solicitante:</span> {request.requesterName} ({request.requesterId})</p><p className="text-gray-600"><span className="font-semibold">Motivo:</span> {request.reason}</p></div>
                <NeonButton variant="secondary" onClick={() => handleApprove(request)} disabled={processingId === request.id}>{processingId === request.id ? 'Procesando...' : 'Aprobar'}</NeonButton>
            </div>
            <div className="mt-4 pt-4 border-t border-slate-300">
              <h4 className="font-semibold text-gray-700 mb-2">Artículos para Aprobación:</h4>
              <div className="max-h-60 overflow-y-auto rounded-lg border border-slate-200">
                  <table className="w-full text-left">
                      <thead className="sticky top-0 bg-slate-100 z-10"><tr><th className="p-2 text-sm font-bold uppercase text-gray-600">Artículo</th><th className="p-2 text-sm font-bold uppercase text-gray-600">Código Colaborador</th><th className="p-2 text-sm font-bold uppercase text-gray-600">Nombre Colaborador</th></tr></thead>
                      <tbody className="bg-white">{request.items.map((item, index) => (<tr key={`${request.id}-${item.itemId}-${index}`} className="border-b border-slate-200 last:border-b-0"><td className="p-2"><p className="font-semibold text-gray-800">{findItemById(item.itemId)?.description || 'Desconocido'}</p><p className="text-sm text-gray-500 font-mono">{item.itemId}</p></td><td className="p-2 font-mono text-gray-700">{item.employees[0].employeeId}</td><td className="p-2 text-gray-800">{item.employees[0].employeeName}</td></tr>))}</tbody>
                  </table>
              </div>
            </div>
          </div>
        )) : <div className="text-center text-gray-500 py-10 border-2 border-dashed border-slate-300 rounded-xl"><svg xmlns="http://www.w3.org/2000/svg" className="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg><p className="mt-4 font-semibold">No hay solicitudes pendientes.</p></div>}
      </div>
      <div className="mt-8 border-t border-slate-200 pt-6"><NeonButton onClick={handleGoBack} variant="primary">Volver</NeonButton></div>
    </div>
  );
};


// ====================================================================================
// In-lined 'components/InventoryScreen.tsx'
// ====================================================================================
const InventoryScreen = ({ onBack }) => {
  const { useState } = React;
  const { state } = useInventory();
  const [searchQuery, setSearchQuery] = useState('');
  const [assistantQuery, setAssistantQuery] = useState('');
  const [assistantResponse, setAssistantResponse] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const filteredInventory = state.inventory.filter(item => item.id.toLowerCase().includes(searchQuery.toLowerCase()) || item.description.toLowerCase().includes(searchQuery.toLowerCase()));

  const handleAssistantSubmit = async (e) => {
      e.preventDefault(); if (!assistantQuery.trim()) return;
      setIsLoading(true); setAssistantResponse('');
      try {
        const response = await GeminiService.getInventoryInsights(state.inventory, assistantQuery);
        setAssistantResponse(response);
      } catch (error) { setAssistantResponse('Error al comunicarse con el asistente.'); } finally { setIsLoading(false); }
  };
  const inputClass = "w-full bg-slate-100 border-2 border-slate-200 rounded-lg px-3 py-2 text-gray-700 focus:border-[#f97216] focus:ring-[#f97216] focus:outline-none transition-colors";

  return (
    <div className="w-full max-w-4xl mx-auto p-8 bg-white rounded-2xl shadow-xl space-y-10">
      <div>
        <h2 className="text-3xl font-extrabold text-gray-800 mb-8">{Screen.INVENTORY}</h2>
        <div className="mb-4"><label className="block text-gray-600 mb-2 font-semibold">Buscar por código o descripción:</label><input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className={inputClass} placeholder="Ej: CAS-001 o Casco"/></div>
        <div className="max-h-72 overflow-y-auto border border-slate-200 rounded-lg">
          <table className="w-full text-left"><thead className="sticky top-0 bg-slate-100 z-10"><tr><th className="p-3 text-sm font-bold uppercase text-gray-600">Código</th><th className="p-3 text-sm font-bold uppercase text-gray-600">Descripción</th><th className="p-3 text-sm font-bold uppercase text-gray-600 text-right">Cantidad</th></tr></thead>
            <tbody className="bg-white">{filteredInventory.map(item => (<tr key={item.id} className="border-b border-slate-200 hover:bg-slate-50"><td className="p-3 font-mono text-gray-700">{item.id}</td><td className="p-3 text-gray-800">{item.description}</td><td className="p-3 text-right font-bold text-xl text-gray-800">{item.quantity}</td></tr>))}</tbody>
          </table>
        </div>
      </div>
      <div className="pt-8 border-t border-slate-200">
        <h3 className="text-2xl font-extrabold text-gray-800 mb-4">Asistente de Inventario IA</h3>
        <form onSubmit={handleAssistantSubmit} className="flex flex-col sm:flex-row gap-4"><input type="text" value={assistantQuery} onChange={e => setAssistantQuery(e.target.value)} className={inputClass} placeholder="Pregunta algo... ej: ¿qué artículos tienen menos de 50 unidades?" disabled={isLoading}/>
            <NeonButton type="submit" variant="secondary" disabled={isLoading} className="flex-shrink-0">{isLoading ? 'Pensando...' : 'Preguntar'}</NeonButton>
        </form>
        {(isLoading || assistantResponse) && <div className="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200 min-h-[6rem]"><p className="text-gray-700 whitespace-pre-wrap font-medium">{isLoading ? "CYBER-CLERK está analizando los datos..." : assistantResponse}</p></div>}
      </div>
      <div className="mt-8 border-t border-slate-200 pt-6"><NeonButton onClick={onBack} variant="primary">Volver</NeonButton></div>
    </div>
  );
};


// ====================================================================================
// In-lined 'components/ConsultationScreen.tsx'
// ====================================================================================
const ConsultationScreen = ({ onBack }) => {
  const { useState } = React;
  const [searchId, setSearchId] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  const [employeeData, setEmployeeData] = useState(null);
  const [searchedId, setSearchedId] = useState(null);

  const handleSearch = async (e) => {
    e.preventDefault(); if (!searchId) return;
    setIsLoading(true); setError(null); setEmployeeData(null); setSearchedId(searchId);
    try {
        const result = await GoogleSheets.getEmployeeDotation(searchId);
        if (result.found && result.data) setEmployeeData(result.data);
        else setError(result.message || 'No se encontraron entregas para el código.');
    } catch(err) { setError(err.message || 'Error al realizar la consulta.'); } finally { setIsLoading(false); }
  };

  const inputClass = "w-full bg-slate-100 border-2 border-slate-200 rounded-lg px-3 py-2 text-gray-700 focus:border-[#f97216] focus:ring-[#f97216] focus:outline-none transition-colors";
  const receivedEppColumns = employeeData ? Object.keys(employeeData.items) : [];

  return (
    <div className="w-full max-w-7xl mx-auto p-8 bg-white rounded-2xl shadow-xl">
      <h2 className="text-3xl font-extrabold text-gray-800 mb-8">{Screen.CONSULTA_DE_DOTACION}</h2>
      <form onSubmit={handleSearch} className="flex flex-col sm:flex-row gap-4 mb-8">
        <input type="text" value={searchId} onChange={(e) => setSearchId(e.target.value)} className={inputClass} placeholder="Introduzca el código del colaborador (ej: 5658)" disabled={isLoading}/>
        <NeonButton type="submit" variant="secondary" className="flex-shrink-0" disabled={isLoading}>{isLoading ? 'Buscando...' : 'Buscar'}</NeonButton>
      </form>
      {searchedId && !isLoading && (
        <div className="mt-8">
          {employeeData ? (
            <div>
              <div className="mb-4 p-4 border border-blue-200 bg-blue-50 rounded-lg"><p className="font-bold text-blue-800">Mostrando dotación para: <span className="font-mono">{employeeData.employeeName} ({employeeData.employeeId})</span></p></div>
              {receivedEppColumns.length > 0 ? (<div className="max-w-full overflow-x-auto"><table className="min-w-full text-left border-collapse border border-slate-300"><thead className="bg-slate-100"><tr><th className="p-3 text-sm font-bold uppercase text-gray-600 border border-slate-300">ID Empleado</th><th className="p-3 text-sm font-bold uppercase text-gray-600 border border-slate-300">Nombre</th>{receivedEppColumns.map(desc => (<th key={desc} className="p-3 text-sm font-bold uppercase text-gray-600 border border-slate-300 whitespace-nowrap">{desc}</th>))}</tr></thead><tbody className="bg-white"><tr><td className="p-3 font-mono text-gray-700 border border-slate-300">{employeeData.employeeId}</td><td className="p-3 text-gray-800 font-semibold border border-slate-300">{employeeData.employeeName}</td>{receivedEppColumns.map(desc => (<td key={desc} className="p-3 text-center text-gray-700 border border-slate-300">{employeeData.items[desc] || '-'}</td>))}</tr></tbody></table></div>) : (<div className="text-center text-gray-500 py-10 border-2 border-dashed border-slate-300 rounded-xl"><p className="font-semibold">Este colaborador no tiene EPP asignado actualmente.</p></div>)}
            </div>
          ) : <div className="text-center text-gray-500 py-10 border-2 border-dashed border-slate-300 rounded-xl"><p className="font-semibold">{error ? error : <>No se encontraron entregas para el código: <span className="font-mono">{searchedId}</span></>} </p></div>}
        </div>
      )}
      <div className="mt-10 border-t border-slate-200 pt-6"><NeonButton onClick={onBack} variant="primary">Volver</NeonButton></div>
    </div>
  );
};


// ====================================================================================
// In-lined 'App.tsx'
// ====================================================================================
const App = () => {
  const { useState } = React;
  const { state, loginApprover, findApproverById } = useInventory();
  const [currentScreen, setCurrentScreen] = useState(Screen.HOME);
  const [accessAttempt, setAccessAttempt] = useState(null);
  const [toasts, setToasts] = useState([]);
  
  if (state.isLoading) return <div className="fixed inset-0 bg-white flex flex-col justify-center items-center"><svg className="animate-spin h-12 w-12 text-[#f97216]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p className="mt-4 text-lg font-semibold text-gray-700">Cargando datos...</p></div>;
  if (state.error) return <div className="fixed inset-0 bg-red-50 flex flex-col justify-center items-center p-4"><div className="text-center"><h2 className="text-2xl font-bold text-red-700">Error Inesperado</h2><p className="mt-2 text-red-600">{state.error}</p><p className="mt-4 text-sm text-gray-500">Por favor, recargue la página.</p></div></div>;

  const handleNavClick = (screen) => {
    if (screen === Screen.DELIVERY || screen === Screen.INVENTORY || PASSWORDS[screen]) setAccessAttempt(screen);
    else setCurrentScreen(screen);
  };
  const handlePasswordSuccess = (password) => {
    if (accessAttempt === Screen.DELIVERY) {
      const approver = findApproverById(password);
      if (approver) loginApprover(approver);
    }
    if (accessAttempt) { setCurrentScreen(accessAttempt); setAccessAttempt(null); }
  };
  const getValidationFunction = (screen) => {
    if (screen === Screen.DELIVERY || screen === Screen.INVENTORY) return (password) => !!findApproverById(password);
    return (password) => password === PASSWORDS[screen];
  };
  const showToast = (message, type = 'success') => {
    const newToast = { id: Date.now(), message, type };
    setToasts(prev => [...prev, newToast]);
  };
  const dismissToast = (id) => setToasts(prev => prev.filter(toast => toast.id !== id));

  const renderScreen = () => {
    switch (currentScreen) {
      case Screen.REQUEST: return <RequestScreen onBack={() => setCurrentScreen(Screen.HOME)} showToast={showToast} />;
      case Screen.DELIVERY: return <DeliveryScreen onBack={() => setCurrentScreen(Screen.HOME)} showToast={showToast} />;
      case Screen.CONSULTA_DE_DOTACION: return <ConsultationScreen onBack={() => setCurrentScreen(Screen.HOME)} />;
      case Screen.INVENTORY: return <InventoryScreen onBack={() => setCurrentScreen(Screen.HOME)} />;
      case Screen.HOME:
      default:
        const NavCard = ({ title, icon, onClick, notificationCount = 0 }) => (
          <div onClick={onClick} className="relative bg-white p-8 rounded-2xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 cursor-pointer text-center group">
            {notificationCount > 0 && (<div className="absolute top-2 right-2"><div className="absolute w-8 h-8 rounded-full bg-red-400 animate-ping opacity-75"></div><div className="relative w-8 h-8 rounded-full bg-red-600 text-white text-sm font-bold flex items-center justify-center border-2 border-white">{notificationCount}</div></div>)}
            <div className="text-[#f97216] w-16 h-16 mx-auto mb-4 group-hover:scale-110 transition-transform">{React.cloneElement(icon, { className: "w-full h-full" })}</div>
            <h3 className="text-xl font-bold text-gray-800">{title}</h3>
          </div>
        );
        return (
          <div className="w-full max-w-7xl mx-auto px-4">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
              <NavCard title={Screen.REQUEST} icon={<RequestIcon />} onClick={() => handleNavClick(Screen.REQUEST)} />
              <NavCard title={Screen.DELIVERY} icon={<DeliveryIcon />} onClick={() => handleNavClick(Screen.DELIVERY)} notificationCount={state.requests.length} />
              <NavCard title={Screen.CONSULTA_DE_DOTACION} icon={<ConsultationIcon />} onClick={() => handleNavClick(Screen.CONSULTA_DE_DOTACION)} />
              <NavCard title={Screen.INVENTORY} icon={<InventoryIcon />} onClick={() => handleNavClick(Screen.INVENTORY)} />
            </div>
          </div>
        );
    }
  };
  return (
    <Layout>
      <div className="pt-24 pb-12 md:pt-32 md:pb-24">{renderScreen()}</div>
      {accessAttempt && <PasswordModal screen={accessAttempt} validatePassword={getValidationFunction(accessAttempt)} onSuccess={handlePasswordSuccess} onClose={() => setAccessAttempt(null)} />}
      <div className="fixed bottom-5 right-5 space-y-3 z-[100]">{toasts.map(toast => (<Toast key={toast.id} message={toast} onDismiss={dismissToast} />))}</div>
    </Layout>
  );
};


// ====================================================================================
// In-lined 'index.tsx' (Entry point)
// ====================================================================================
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}
const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <InventoryProvider>
      <App />
    </InventoryProvider>
  </React.StrictMode>
);

    </script>
</body>
</html>